spring:
  codec:
    max-in-memory-size: 16MB
  redis:
    host: dev-middleware-redis
    password: 123456
    timeout: 5s
    database: 0
  cloud:
    gateway:
      filter:
        request-rate-limiter:
          deny-empty-key: false
      routes:
        - id: cookie_route
          uri: https://www.sina.com.cn/
          predicates:
            - Cookie=mycookie,mycookievalue
        - id: after_route
          uri: https://www.sina.com.cn/
          predicates:
            - After=2050-04-20T15:00:00+08:00
        - id: before_route
          uri: https://www.sina.com.cn/
          predicates:
            - Before=2020-04-20T15:00:00+08:00
        - id: between_route
          uri: https://www.sina.com.cn/
          predicates:
            - Between=2040-01-20T17:42:47+08:00, 2050-01-21T17:42:47+08:00
        - id: header_route
          uri: https://www.sina.com.cn/
          predicates:
            - Header=X-Request-Id, \d+
        - id: host_route
          uri: https://www.sina.com.cn/
          predicates:
            - Host=**.dev.com
        - id: method_route
          uri: https://www.sina.com.cn/
          predicates:
            - Method=HEAD,DELETE
        - id: path_route
          uri: https://www.sina.com.cn/
          predicates:
            - Path=/red/{segment},/blue/{segment}
        - id: query_route
          uri: https://www.sina.com.cn/
          predicates:
            - Query=red, gree.
        - id: remoteaddr_route
          uri: https://www.sina.com.cn/
          predicates:
            - RemoteAddr=127.0.0.2/32
        - id: xforwarded_remoteaddr_route
          uri: https://www.sina.com.cn/
          predicates:
            - XForwardedRemoteAddr=192.168.1.1/24





        # 熔断配置
        - id: circuitbreaker_route_1
          uri: lb://backing-service:8088
          predicates:
            - Path=/circuitbreaker-route-1
          filters:
            - name: CircuitBreaker
              args:
                name: myCircuitBreaker
                fallbackUri: forward:/error/503
                statusCodes:
                  - 500
                  - "NOT_FOUND"
        - id: circuitbreaker_route_2
          uri: lb://backing-service:8088
          predicates:
            - Path=/circuitbreaker-route-2
          filters:
            - name: CircuitBreaker
              args:
                name: myCircuitBreaker
                fallbackUri: forward:/error/500
            - RewritePath=/circuitbreaker-route-2, /backingServiceEndpoint


        - id: circuitbreaker_route_3
          uri: lb://backing-service:8088
          predicates:
            - Path=/circuitbreaker-route-3/**
          filters:
            - name: CircuitBreaker
              args:
                name: myCircuitBreaker
                fallbackUri: forward:/nba
        - id: circuitbreaker_route_3_fallback
          uri: https://sports.sina.com.cn
          predicates:
            - Path=/nba

        - id: circuitbreaker_route_4
          uri: lb://backing-service:8088
          predicates:
            - Path=/circuitbreaker-route-4/**
          filters:
            - name: CircuitBreaker
              args:
                name: myCircuitBreaker
                fallbackUri: forward:/nba
        - id: circuitbreaker_route_4_fallback
          uri: https://sports.sina.com.cn
          predicates:
            - Path=/nba
          filters:
            - name: FallbackHeaders
              args:
                executionExceptionTypeHeaderName: Test-Header

        - id: map_request_header_route
          uri: https://www.sina.com.cn/
          predicates:
            - Path=/map-request-header
          filters:
            - MapRequestHeader=Blue, X-Request-Red

        - id: prefixpath_route
          uri: https://www.sina.com.cn
          predicates:
            - Path=/prefixpath
          filters:
            - PrefixPath=/pre

        # 限流配置
        - id: request_ratelimiter_route
          uri: https://www.sina.com.cn
          predicates:
            - Path=/request-ratelimiter/**
          filters:
            - name: RequestRateLimiter
              args:
                name: REDIS
                key-resolver: "#{@ipKeyResolver}"
                redis-rate-limiter.replenishRate: 1
                redis-rate-limiter.burstCapacity: 60
                redis-rate-limiter.requestedTokens: 60

        # 重定向
        - id: redirect_route
          uri: https://www.sohu.com
          predicates:
            - Path=/redirect/**
          filters:
            - RedirectTo=302, https://www.sina.com.cn

        # 重写
        - id: rewrite_path1_route
          uri: https://order.glodon.com
          predicates:
            - Path=/rewrite-path-1/**
          filters:
            - RewritePath=/rewrite-path-1/?(?<segment>.*), /$\{segment}
        - id: rewrite_path2_route
          uri: https://order.glodon.com
          predicates:
            - Path=/rewrite-path-2/**
          filters:
            - RewritePath=/rewrite-path-2/?(?<segment>.*), /rewrite-path-2-new/$\{segment}
        - id: rewrite_path3_route
          uri: https://order.glodon.com
          predicates:
            - Path=/rewrite-path-3/**
          filters:
            - RewritePath=/rewrite-path-3/?(?<segment>.*), /rewrite-path-3-new/rewrite-path-3/$\{segment}

        # Set path
        - id: set_path_route
          uri: https://order.glodon.com
          predicates:
            - Path=/set-path/{segment}
          filters:
            - SetPath=/{segment}

        # Set status
        - id: set_status_1_route
          uri: https://www.sina.com.cn
          predicates:
            - Path=/set-status-1/**
          filters:
            - SetStatus=UNAUTHORIZED
        - id: set_status_2_route
          uri: https://www.sina.com.cn
          predicates:
            - Path=/set-status-2/**
          filters:
            - SetStatus=401

        # Strip prefix
        - id: strip_prefix_route
          uri: https://order.glodon.com
          predicates:
            - Path=/strip-prefix/**
          filters:
            - StripPrefix=2

        # Request size
        - id: request_size_route
          uri: https://order.glodon.com
          predicates:
            - Path=/request_size
          filters:
            - name: RequestSize
              args:
                # Bytes
                maxSize: 1